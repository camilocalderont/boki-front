<div class="w-full h-full relative">
  <!-- Mapa container -->
  <div #mapContainer id="map-{{mapId}}" class="w-full h-full rounded-2xl shadow-lg overflow-hidden"
    [style.min-height]="minHeight">
  </div>

  <!-- Loading overlay -->
  <div *ngIf="loading"
    class="absolute inset-0 bg-white/90 backdrop-blur-sm flex items-center justify-center rounded-2xl">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto mb-4"></div>
      <p class="text-gray-600 font-medium">Cargando mapa...</p>
    </div>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !loading" class="absolute inset-0 bg-red-50 flex items-center justify-center rounded-2xl">
    <div class="text-center p-8">
      <div class="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
        <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z">
          </path>
        </svg>
      </div>
      <h3 class="text-lg font-semibold text-red-800 mb-2">Error al cargar el mapa</h3>
      <p class="text-red-600 mb-4">{{ error }}</p>
      <button (click)="initializeMap()"
        class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors duration-200">
        Reintentar
      </button>
    </div>
  </div>

  <!-- Map controls -->
  <div class="absolute top-4 right-4 z-[1000] flex flex-col space-y-2">
    <!-- Zoom controls -->
    <div class="bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-1">
      <button (click)="zoomIn()"
        class="w-8 h-8 rounded hover:bg-gray-100 transition-colors duration-200 flex items-center justify-center"
        title="Acercar">
        <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
      </button>
      <button (click)="zoomOut()"
        class="w-8 h-8 rounded hover:bg-gray-100 transition-colors duration-200 flex items-center justify-center"
        title="Alejar">
        <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
        </svg>
      </button>
    </div>

    <!-- Reset view -->
    <button (click)="resetView()"
      class="bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-2 hover:bg-white transition-colors duration-200"
      title="Vista completa de Colombia">
      <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4">
        </path>
      </svg>
    </button>

    <!-- Toggle markers -->
    <button (click)="toggleMarkers()"
      class="bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-2 hover:bg-white transition-colors duration-200"
      [class.bg-orange-100]="markersVisible" [title]="markersVisible ? 'Ocultar marcadores' : 'Mostrar marcadores'">
      <svg class="w-4 h-4" [class.text-orange-600]="markersVisible" [class.text-gray-600]="!markersVisible" fill="none"
        stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z">
        </path>
      </svg>
    </button>
  </div>

  <!-- Markers info panel -->
  <div *ngIf="showMarkersPanel && markers.length > 0"
    class="absolute bottom-4 left-4 right-4 z-[1000] bg-white/95 backdrop-blur-sm rounded-xl shadow-xl p-4 max-h-48 overflow-y-auto">
    <div class="flex items-center justify-between mb-3">
      <h3 class="font-semibold text-gray-900">Marcadores ({{ markers.length }})</h3>
      <button (click)="showMarkersPanel = false"
        class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <div class="space-y-2 max-h-32 overflow-y-auto">
      <button *ngFor="let marker of markers; trackBy: trackByMarkerId" (click)="focusMarker(marker)"
        class="w-full text-left p-2 rounded-lg hover:bg-orange-50 transition-colors duration-200 group">
        <div class="font-medium text-gray-900 group-hover:text-orange-600 text-sm">{{ marker.nombre }}</div>
        <div class="text-xs text-gray-500 line-clamp-2">{{ marker.descripcion }}</div>
      </button>
    </div>
  </div>

  <!-- Toggle markers panel button -->
  <button *ngIf="markers.length > 0" (click)="showMarkersPanel = !showMarkersPanel"
    class="absolute bottom-4 left-4 z-[1000] bg-orange-600 text-white p-3 rounded-full shadow-lg hover:bg-orange-700 transition-all duration-200 transform hover:scale-105"
    [class.bg-orange-700]="showMarkersPanel">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
      </path>
    </svg>
  </button>
</div>
